<div class="fixed w-full z-10 bottom-0">

  <div class="flex flex-wrap justify-between bg-black items-center">
    <container class="mx-auto p-3">
      <img id="coverImage" src="https://placeholder.co/80x80" class="rounded" alt="">
    </container>
    <container class="mx-auto text-center">
      <h1 id="songTitle" class="lg:text-4xl md:text-2xl sm:text-normal font-extrabold text-white m-2">Song Title</h1>
      <h1 id="artistName" class="lg:text-xl md:text-lg sm:text-normal font-regular text-white m-2">Artist Name</h1>
    </container>
    <container class="flex space-x-10 mx-auto">
      <img id="prevButton" class="m-1" src="/asset/prev.png" style="width:30px; height:30px;" alt="">
      <img id="playPauseButton" class="m-1" src="/asset/play.png" style="width:30px; height:30px;" alt="">
      <img id="nextButton" class="m-1" src="/asset/next.png" style="width:30px; height:30px;" alt="">
    </container>
  </div>
  <div class="flex items-center justify-between w-full bg-black p-2">
    <p id="startTime" class="text-xs text-white">0:00</p>
    <div class="w-full mx-3 items-center">
      <input type="range" class="w-full" min="0" max="100" value="0" id="progressBar">
    </div>
    <p id="endTime" class="text-xs text-white">0:00</p>
  </div>
</div>

<script id="playlist" src="components/playlist.js" defer></script>

<script>
const playPauseButton = document.getElementById('playPauseButton');
const prevButton = document.getElementById('prevButton');
const nextButton = document.getElementById('nextButton');
const coverImage = document.getElementById('coverImage');
const songTitle = document.getElementById('songTitle');
const artistName = document.getElementById('artistName');
const progressBar = document.getElementById('progressBar');
const startTime = document.getElementById('startTime');
const endTime = document.getElementById('endTime');

let isPlaying = false; // Track whether the audio is currently playing
let currentTime = 0; // Track the current playback time



let currentSongIndex = 0; // Track the index of the current song

// Function to format time in MM:SS format
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = Math.floor(seconds % 60);
  return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}

// Function to play or pause the audio
function togglePlayPause() {
  if (isPlaying) {
    audio.pause();
  } else {
    audio.play();
  }
  isPlaying = !isPlaying;
  playPauseButton.src = isPlaying ? '/asset/pause.png' : '/asset/play.png';
}

// Event listeners for play, pause, previous, and next buttons
playPauseButton.addEventListener('click', togglePlayPause);
prevButton.addEventListener('click', playPreviousSong);
nextButton.addEventListener('click', playNextSong);

// Create audio element
const audio = new Audio();
audio.src = playlist[currentSongIndex].audio;
audio.addEventListener('loadedmetadata', () => {
  endTime.textContent = formatTime(audio.duration);
});

// Event listener for updating progress bar
audio.addEventListener('timeupdate', () => {
  currentTime = Math.floor(audio.currentTime);
  progressBar.value = (currentTime / audio.duration) * 100;
  startTime.textContent = formatTime(currentTime);
});

// Event listener for when the song ends
audio.addEventListener('ended', playNextSong);

// Event listener for when the progress bar value changes
progressBar.addEventListener('input', () => {
  const seekTime = (progressBar.value / 100) * audio.duration;
  audio.currentTime = seekTime;
  startTime.textContent = formatTime(seekTime);
});

// Function to play the previous song
function playPreviousSong() {
  currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
  loadCurrentSong();
}

// Function to play the next song
function playNextSong() {
  currentSongIndex = (currentSongIndex + 1) % playlist.length;
  loadCurrentSong();
}

// Function to load the current song
function loadCurrentSong() {
  audio.src = playlist[currentSongIndex].audio;
  coverImage.src = playlist[currentSongIndex].cover;
  songTitle.textContent = playlist[currentSongIndex].title;
  artistName.textContent = playlist[currentSongIndex].artist;
  audio.play();
  isPlaying = true;
  playPauseButton.src = '/asset/pause.png';
  audio.addEventListener('loadedmetadata', () => {
    endTime.textContent = formatTime(audio.duration);
  });
}

// Initialize the player UI
loadCurrentSong();

</script>